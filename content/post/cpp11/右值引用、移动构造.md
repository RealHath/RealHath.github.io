---
title: 右值引用、移动构造
tags: ["C++", "编程学习"]
categories: ["C++"]
date: "2021-03-28 13:17:55"
toc: true
---


# 1 右值引用
左值的英文简写为“lvalue”，右值的英文简写为“rvalue”。很多人认为它们分别是"left value"、"right value" 的缩写，其实不然。lvalue 是“locator value”的缩写，可意为存储在内存中、有明确存储地址（可寻址）的数据，而 rvalue 译为 "read value"，指的是那些可以提供数据值的数据（不一定可以寻址，例如存储于寄存器中的数据）。


左值引用指的是引用可寻址的值，也就是引用左值

右值引用引用的是可读但不一定能寻址的值，也就是引用右值


引用类型	|可以引用的值类型	|使用场景
-|-|-
||非常量左值	常量左值	非常量右值	常量右值|
非常量左值引用|	Y	N	N	N	|无
常量左值引用|	Y	Y	Y	Y	|常用于类中构建拷贝构造函数
非常量右值引用|	N	N	Y	N	|移动语义、完美转发
常量右值引用|	N	N	Y	Y	|无实际用途

# 2 移动构造
![](https://upload-images.jianshu.io/upload_images/4427263-81a47fdc9b8d9e98.png?imageMogr2/auto-orient/strip|imageView2/2/w/264/format/webp)

移动构造函数与拷贝构造函数的区别是，拷贝构造的参数是const MyString& str，是常量左值引用，而移动构造的参数是MyString&& str，是右值引用，而MyString("hello")是个临时对象，是个右值，优先进入移动构造函数而不是拷贝构造函数。而移动构造函数与拷贝构造不同，它并不是重新分配一块新的空间，将要拷贝的对象复制过来，而是"偷"了过来，将自己的指针指向别人的资源，然后将别人的指针修改为nullptr，这一步很重要，如果不将别人的指针修改为空，那么临时对象析构的时候就会释放掉这个资源，"偷"也白偷了。下面这张图可以解释copy和move的区别。
